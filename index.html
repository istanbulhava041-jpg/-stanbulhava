<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ƒ∞stanbul Hava Durumu Pro</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-grad: linear-gradient(180deg, #4A90E2 0%, #87CEEB 100%);
            --card-bg: rgba(255, 255, 255, 0.2);
            --text-color: #fff;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Inter', sans-serif; }

        body {
            background: var(--bg-grad);
            background-attachment: fixed;
            min-height: 100vh;
            color: var(--text-color);
            display: flex;
            justify-content: center;
            padding: 20px;
            overflow-x: hidden;
        }

        .container { width: 100%; max-width: 500px; z-index: 10; }

        /* Se√ßim Alanƒ± */
        .selectors { display: flex; gap: 10px; margin-bottom: 20px; }
        select {
            flex: 1; padding: 12px; border-radius: 12px; border: none;
            background: var(--card-bg); color: white; backdrop-filter: blur(10px);
            outline: none; font-size: 14px; cursor: pointer;
        }
        select option { color: #333; }

        /* Ana Kart */
        .main-card {
            background: var(--card-bg); backdrop-filter: blur(15px);
            border-radius: 24px; padding: 30px; text-align: center;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1); margin-bottom: 20px;
        }
        .temp-big { font-size: 72px; font-weight: 300; margin: 10px 0; }
        .details-grid {
            display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px;
            margin-top: 20px; font-size: 14px;
        }
        .detail-item { background: rgba(255,255,255,0.1); padding: 10px; border-radius: 12px; }

        /* Grafik */
        .chart-container {
            background: var(--card-bg); backdrop-filter: blur(15px);
            border-radius: 24px; padding: 20px; margin-bottom: 20px;
        }

        /* 7 G√ºnl√ºk Tahmin */
        .forecast-scroll {
            display: flex; gap: 15px; overflow-x: auto; padding-bottom: 10px;
            scrollbar-width: none;
        }
        .forecast-scroll::-webkit-scrollbar { display: none; }
        .forecast-item {
            min-width: 80px; background: var(--card-bg); padding: 15px;
            border-radius: 16px; text-align: center;
        }

        /* Animasyonlar */
        #weather-anim {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; z-index: 1;
        }
        .drop {
            position: absolute; background: rgba(255,255,255,0.6);
            width: 2px; height: 15px; animation: fall linear infinite;
        }
        .snow {
            position: absolute; background: white; border-radius: 50%;
            width: 5px; height: 5px; animation: fall linear infinite;
        }
        @keyframes fall { to { transform: translateY(100vh); } }
    </style>
</head>
<body>

<div id="weather-anim"></div>

<div class="container">
    <div class="selectors">
        <select id="districts" onchange="updateNeighborhoods()">
            </select>
        <select id="neighborhoods" onchange="fetchWeather()">
            </select>
    </div>

    <div class="main-card">
        <h2 id="loc-name">Y√ºkleniyor...</h2>
        <div class="temp-big" id="current-temp">--¬∞</div>
        <p id="weather-desc">Durum</p>
        <div class="details-grid">
            <div class="detail-item">Hissedilen: <b id="feel-temp">--¬∞</b></div>
            <div class="detail-item">Nem: <b id="humidity">%--</b></div>
            <div class="detail-item">R√ºzgar: <b id="wind">-- km/s</b></div>
            <div class="detail-item">UV: <b id="uv">--</b></div>
        </div>
    </div>

    <div class="chart-container">
        <canvas id="hourlyChart"></canvas>
    </div>

    <div class="forecast-scroll" id="forecast">
        </div>
</div>

<script>
const data = {
    "Adalar": {lat: 40.85, lon: 29.12, n: ["B√ºy√ºkada", "Heybeliada", "Burgazada"]},
    "Arnavutk√∂y": {lat: 41.18, lon: 28.74, n: ["Hadƒ±mk√∂y", "Bolluca", "Hara√ß√ßƒ±"]},
    "Ata≈üehir": {lat: 40.98, lon: 29.11, n: ["Barbaros", "ƒ∞√ßerenk√∂y", "Kayƒ±≈üdaƒüƒ±"]},
    "Avcƒ±lar": {lat: 40.98, lon: 28.71, n: ["Ambarlƒ±", "Cihangir", "Denizk√∂≈ükler"]},
    "Baƒücƒ±lar": {lat: 41.03, lon: 28.83, n: ["G√ºne≈üli", "Kirazlƒ±", "Mahmutbey"]},
    "Bah√ßelievler": {lat: 41.00, lon: 28.85, n: ["Yenibosna", "≈ûirinevler", "Kocasinan"]},
    "Bakƒ±rk√∂y": {lat: 40.97, lon: 28.87, n: ["Florya", "Ye≈üilk√∂y", "Atak√∂y"]},
    "Ba≈üak≈üehir": {lat: 41.09, lon: 28.80, n: ["Bah√ße≈üehir", "Kaya≈üehir", "G√ºvercintepe"]},
    "Bayrampa≈üa": {lat: 41.04, lon: 28.90, n: ["Yƒ±ldƒ±rƒ±m", "Altƒ±ntepsi", "Kocatepe"]},
    "Be≈üikta≈ü": {lat: 41.04, lon: 29.00, n: ["Bebek", "Etiler", "Ortak√∂y", "Levent"]},
    "Beykoz": {lat: 41.11, lon: 29.09, n: ["Kavacƒ±k", "Kanlƒ±ca", "Pa≈üabah√ße"]},
    "Beylikd√ºz√º": {lat: 41.00, lon: 28.63, n: ["Adnan Kahveci", "G√ºrpƒ±nar", "Yakuplu"]},
    "Beyoƒülu": {lat: 41.03, lon: 28.97, n: ["Taksim", "Cihangir", "Karak√∂y", "S√ºtl√ºce"]},
    "B√ºy√ºk√ßekmece": {lat: 41.02, lon: 28.58, n: ["Mimaroba", "Kumburgaz", "Tepecik"]},
    "√áatalca": {lat: 41.14, lon: 28.46, n: ["Kalei√ßi", "Ferhatpa≈üa", "Binkƒ±lƒ±√ß"]},
    "√áekmek√∂y": {lat: 41.03, lon: 29.17, n: ["Alemdaƒü", "Ta≈üdelen", "√ñmerli"]},
    "Esenler": {lat: 41.03, lon: 28.89, n: ["Turgut Reis", "Havaalanƒ±", "Birlik"]},
    "Esenyurt": {lat: 41.03, lon: 28.67, n: ["Saadetdere", "Kƒ±ra√ß", "Mehter√ße≈üme"]},
    "Ey√ºpsultan": {lat: 41.05, lon: 28.93, n: ["G√∂kt√ºrk", "Alibeyk√∂y", "Kemerburgaz"]},
    "Fatih": {lat: 41.01, lon: 28.94, n: ["Sultanahmet", "Balat", "Aksaray", "Emin√∂n√º"]},
    "Gaziosmanpa≈üa": {lat: 41.05, lon: 28.90, n: ["Baƒülarba≈üƒ±", "K√º√ß√ºkk√∂y", "Karadeniz"]},
    "G√ºng√∂ren": {lat: 41.02, lon: 28.87, n: ["Merter", "Haznedar", "Tozkoparan"]},
    "Kadƒ±k√∂y": {lat: 40.99, lon: 29.02, n: ["Moda", "Fenerbah√ße", "Bostancƒ±", "Erenk√∂y"]},
    "Kaƒüƒ±thane": {lat: 41.08, lon: 28.97, n: ["G√ºltepe", "√áeliktepe", "Seyrantepe"]},
    "Kartal": {lat: 40.90, lon: 29.19, n: ["Soƒüanlƒ±k", "Yakacƒ±k", "Dragos"]},
    "K√º√ß√ºk√ßekmece": {lat: 41.00, lon: 28.77, n: ["Halkalƒ±", "ƒ∞kitelli", "Sefak√∂y"]},
    "Maltepe": {lat: 40.93, lon: 29.14, n: ["K√º√ß√ºkyalƒ±", "ƒ∞dealtepe", "Z√ºmr√ºtevler"]},
    "Pendik": {lat: 40.87, lon: 29.23, n: ["Kurtk√∂y", "Kaynarca", "G√ºzelyalƒ±"]},
    "Sancaktepe": {lat: 41.00, lon: 29.23, n: ["Samandƒ±ra", "Yenidoƒüan", "Sarƒ±gazi"]},
    "Sarƒ±yer": {lat: 41.17, lon: 29.05, n: ["Tarabya", "ƒ∞stinye", "Zekeriyak√∂y", "Emirgan"]},
    "Silivri": {lat: 41.07, lon: 28.24, n: ["Selimpa≈üa", "G√ºm√º≈üyaka", "Ortak√∂y"]},
    "Sultanbeyli": {lat: 40.96, lon: 29.26, n: ["Abdurrahmangazi", "Mecidiye", "Hamidiye"]},
    "Sultangazi": {lat: 41.10, lon: 28.86, n: ["Cebeci", "Habibler", "Yunusemre"]},
    "≈ûile": {lat: 41.17, lon: 29.61, n: ["Aƒüva", "Kumbaba", "√áayƒ±rba≈üƒ±"]},
    "≈ûi≈üli": {lat: 41.06, lon: 28.98, n: ["Ni≈üanta≈üƒ±", "Mecidiyek√∂y", "Ferik√∂y", "Bomonti"]},
    "Tuzla": {lat: 40.81, lon: 29.30, n: ["Aydƒ±nlƒ±", "ƒ∞√ßmeler", "Akfƒ±rat"]},
    "√úmraniye": {lat: 41.02, lon: 29.10, n: ["Ihlamurkuyu", "√áakmak", "Dudullu"]},
    "√úsk√ºdar": {lat: 41.02, lon: 29.01, n: ["Kuzguncuk", "Beylerbeyi", "√áengelk√∂y", "Acƒ±badem"]},
    "Zeytinburnu": {lat: 40.99, lon: 28.90, n: ["Merkezefendi", "Telsiz", "Be≈ütelsiz"]}
};

let myChart;
const districtSelect = document.getElementById('districts');
const neighborhoodSelect = document.getElementById('neighborhoods');

// Ba≈ülangƒ±√ß
window.onload = () => {
    for (let d in data) {
        let opt = new Option(d, d);
        districtSelect.add(opt);
    }
    updateNeighborhoods();
};

function updateNeighborhoods() {
    const d = districtSelect.value;
    neighborhoodSelect.innerHTML = '';
    data[d].n.forEach(nh => {
        neighborhoodSelect.add(new Option(nh, nh));
    });
    fetchWeather();
}

async function fetchWeather() {
    const d = districtSelect.value;
    const {lat, lon} = data[d];
    const url = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current=temperature_2m,relative_humidity_2m,apparent_temperature,weather_code,wind_speed_10m&hourly=temperature_2m&daily=weather_code,temperature_2m_max,temperature_2m_min,uv_index_max&timezone=Europe%2FIstanbul`;

    try {
        const res = await fetch(url);
        if(!res.ok) throw new Error();
        const json = await res.json();
        updateUI(json);
    } catch (e) {
        alert("Hava durumu verisi alƒ±namadƒ±. L√ºtfen internetinizi kontrol edin.");
    }
}

function updateUI(json) {
    const current = json.current;
    document.getElementById('loc-name').innerText = `${neighborhoodSelect.value}, ${districtSelect.value}`;
    document.getElementById('current-temp').innerText = `${Math.round(current.temperature_2m)}¬∞`;
    document.getElementById('feel-temp').innerText = `${Math.round(current.apparent_temperature)}¬∞`;
    document.getElementById('humidity').innerText = `%${current.relative_humidity_2m}`;
    document.getElementById('wind').innerText = `${current.wind_speed_10m} km/s`;
    document.getElementById('uv').innerText = json.daily.uv_index_max[0];
    
    const code = current.weather_code;
    document.getElementById('weather-desc').innerText = getWeatherDesc(code);
    
    updateChart(json.hourly);
    updateForecast(json.daily);
    setAnimations(code);
}

function getWeatherDesc(code) {
    if (code === 0) return "A√ßƒ±k G√∂ky√ºz√º";
    if (code <= 3) return "Par√ßalƒ± Bulutlu";
    if (code <= 48) return "Sisli";
    if (code <= 67) return "Yaƒümurlu";
    if (code <= 77) return "Kar Yaƒüƒ±≈ülƒ±";
    if (code <= 82) return "Saƒüanak Yaƒüƒ±≈ü";
    return "Fƒ±rtƒ±na";
}

function updateChart(hourly) {
    const ctx = document.getElementById('hourlyChart').getContext('2d');
    if (myChart) myChart.destroy();
    
    myChart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: hourly.time.slice(0, 24).map(t => t.split('T')[1]),
            datasets: [{
                label: 'Sƒ±caklƒ±k (¬∞C)',
                data: hourly.temperature_2m.slice(0, 24),
                borderColor: '#fff',
                backgroundColor: 'rgba(255,255,255,0.2)',
                fill: true,
                tension: 0.4
            }]
        },
        options: {
            responsive: true,
            plugins: { legend: { display: false } },
            scales: {
                x: { ticks: { color: '#fff' }, grid: { display: false } },
                y: { ticks: { color: '#fff' }, grid: { color: 'rgba(255,255,255,0.1)' } }
            }
        }
    });
}

function updateForecast(daily) {
    const container = document.getElementById('forecast');
    container.innerHTML = '';
    const emojis = {0: '‚òÄÔ∏è', 1: 'üå§Ô∏è', 2: '‚õÖ', 3: '‚òÅÔ∏è', 45: 'üå´Ô∏è', 61: 'üåßÔ∏è', 71: '‚ùÑÔ∏è', 95: '‚õàÔ∏è'};

    for(let i=0; i<7; i++) {
        const date = new Date(daily.time[i]).toLocaleDateString('tr', {weekday: 'short'});
        const div = document.createElement('div');
        div.className = 'forecast-item';
        div.innerHTML = `
            <div>${date}</div>
            <div style="font-size:24px; margin:8px 0">${emojis[daily.weather_code[i]] || '‚òÅÔ∏è'}</div>
            <b>${Math.round(daily.temperature_2m_max[i])}¬∞</b>
            <div style="font-size:12px; opacity:0.7">${Math.round(daily.temperature_2m_min[i])}¬∞</div>
        `;
        container.appendChild(div);
    }
}

function setAnimations(code) {
    const container = document.getElementById('weather-anim');
    container.innerHTML = '';
    
    let type = '';
    if (code >= 51 && code <= 67 || code >= 80) type = 'drop';
    if (code >= 71 && code <= 77) type = 'snow';

    if (type) {
        for (let i = 0; i < 50; i++) {
            const el = document.createElement('div');
            el.className = type;
            el.style.left = Math.random() * 100 + 'vw';
            el.style.animationDuration = (Math.random() * 1 + 0.5) + 's';
            el.style.animationDelay = Math.random() * 2 + 's';
            container.appendChild(el);
        }
    }
}
</script>

</body>
</html>
