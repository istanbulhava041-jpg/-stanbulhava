<script>
const data = {
    "Adalar": {lat: 40.85, lon: 29.12, n: ["Burgazada", "Heybeliada", "KÄ±nalÄ±ada", "Maden", "Nizam"]},
    "ArnavutkÃ¶y": {lat: 41.18, lon: 28.74, n: ["Adnan Menderes", "Anadolu", "ArnavutkÃ¶y Merkez", "AtatÃ¼rk", "BaklalÄ±", "Balaban", "BoÄŸazkÃ¶y", "Bolluca", "BoyalÄ±k", "Ã‡ilingir", "Deliklikaya", "DursunkÃ¶y", "Durusu", "Fatih", "HacÄ±maÅŸlÄ±", "HadÄ±mkÃ¶y", "HaraÃ§Ã§Ä±", "Hastane", "Hicret", "Ä°mrahor", "Ä°slambey", "Karaburun", "KarlÄ±bayÄ±r", "MavigÃ¶l", "Mehmet Akif Ersoy", "Mustafa Kemal PaÅŸa", "Nenehatun", "Ã–merli", "SazlÄ±bosna", "TaÅŸoluk", "TayakadÄ±n", "Terkos", "YassÄ±Ã¶ren", "Yavuz Selim", "YenikÃ¶y", "YeÅŸilbayÄ±r"]},
    "AtaÅŸehir": {lat: 40.98, lon: 29.11, n: ["AÅŸÄ±k Veysel", "AtatÃ¼rk", "Barbaros", "EsatpaÅŸa", "FerhatpaÅŸa", "Fetih", "Ä°Ã§erenkÃ¶y", "Ä°nÃ¶nÃ¼", "KayÄ±ÅŸdaÄŸÄ±", "KÃ¼Ã§Ã¼kbakkalkÃ¶y", "Mevlana", "Mimar Sinan", "Mustafa Kemal", "Ã–rnek", "Yeni Ã‡amlÄ±ca", "Yeni Sahra", "YeniÅŸehir"]},
    "AvcÄ±lar": {lat: 40.98, lon: 28.71, n: ["AmbarlÄ±", "Cihangir", "DenizkÃ¶ÅŸkler", "FiruzkÃ¶y", "GÃ¼mÃ¼ÅŸpala", "Merkez", "Mustafa Kemal PaÅŸa", "Tahtakale", "Ãœniversite", "YeÅŸilkent"]},
    "BaÄŸcÄ±lar": {lat: 41.03, lon: 28.83, n: ["100. YÄ±l", "15 Temmuz", "BaÄŸlar", "Barbaros", "Ã‡Ä±nar", "DemirkapÄ±", "Fatih", "Fevzi Ã‡akmak", "GÃ¶ztepe", "GÃ¼neÅŸli", "HÃ¼rriyet", "Ä°nÃ¶nÃ¼", "KazÄ±m Karabekir", "KemalpaÅŸa", "KirazlÄ±", "Mahmutbey", "Merkez", "Sancaktepe", "Yavuz Selim", "YenigÃ¼n", "Yenimahalle", "YÄ±ldÄ±ztepe"]},
    "BahÃ§elievler": {lat: 41.00, lon: 28.85, n: ["BahÃ§elievler", "Cumhuriyet", "Ã‡obanÃ§eÅŸme", "Fevzi Ã‡akmak", "HÃ¼rriyet", "Kocasinan", "SiyavuÅŸpaÅŸa", "SoÄŸanlÄ±", "Åirinevler", "Yenibosna", "Zafer"]},
    "BakÄ±rkÃ¶y": {lat: 40.97, lon: 28.87, n: ["AtakÃ¶y 1.", "AtakÃ¶y 2-5-6.", "AtakÃ¶y 3-4-11.", "AtakÃ¶y 7-8-9-10.", "Cevizlik", "Kartaltepe", "Osmaniye", "SakÄ±zaÄŸacÄ±", "ÅenlikkÃ¶y", "Yenimahalle", "YeÅŸilkÃ¶y", "YeÅŸilyurt", "Zeytinlik", "Zuhuratbaba", "Florya"]},
    "BaÅŸakÅŸehir": {lat: 41.09, lon: 28.80, n: ["AltÄ±nÅŸehir", "BahÃ§eÅŸehir 1. KÄ±sÄ±m", "BahÃ§eÅŸehir 2. KÄ±sÄ±m", "BaÅŸak", "BaÅŸakÅŸehir", "GÃ¼vercintepe", "Ä°kitelli OSB", "KayabaÅŸÄ±", "Åahintepe", "Åamlar", "Ziya GÃ¶kalp"]},
    "BayrampaÅŸa": {lat: 41.04, lon: 28.90, n: ["AltÄ±ntepsi", "CevatpaÅŸa", "Ä°smet PaÅŸa", "Kartaltepe", "Kocatepe", "MuratpaÅŸa", "Orta", "Terazidere", "Vatan", "YenidoÄŸan", "YÄ±ldÄ±rÄ±m"]},
    "BeÅŸiktaÅŸ": {lat: 41.04, lon: 29.00, n: ["AbbasaÄŸa", "Akat", "ArnavutkÃ¶y", "Balmumcu", "Bebek", "CihannÃ¼ma", "DikilitaÅŸ", "Etiler", "Gayrettepe", "Konaklar", "KuruÃ§eÅŸme", "KÃ¼ltÃ¼r", "LevazÄ±m", "Levent", "Mecidiye", "Muradiye", "Nisbetiye", "OrtakÃ¶y", "SinanpaÅŸa", "TÃ¼rkali", "Ulus", "ViÅŸnezade", "YÄ±ldÄ±z"]},
    "Beykoz": {lat: 41.11, lon: 29.09, n: ["Acarlar", "AnadoluhisarÄ±", "AnadolukavaÄŸÄ±", "BaklacÄ±", "Ã‡amlÄ±bahÃ§e", "Ã‡engeldere", "Ã‡iftlik", "Ã‡iÄŸdem", "Ã‡ubuklu", "Fatih", "GÃ¼mÃ¼ÅŸsuyu", "Ä°ncirkÃ¶y", "KanlÄ±ca", "KavacÄ±k", "Merkez", "OrtaÃ§eÅŸme", "PaÅŸabahÃ§e", "RÃ¼zgarlÄ±bahÃ§e", "SoÄŸuksu", "TokatkÃ¶y", "YalÄ±kÃ¶y", "Yavuz Selim"]},
    "BeylikdÃ¼zÃ¼": {lat: 41.00, lon: 28.63, n: ["Adnan Kahveci", "BarÄ±ÅŸ", "BÃ¼yÃ¼kÅŸehir", "Cumhuriyet", "DereaÄŸzÄ±", "GÃ¼rpÄ±nar", "KavaklÄ±", "Marmara", "Sahil", "Yakuplu"]},
    "BeyoÄŸlu": {lat: 41.03, lon: 28.97, n: ["Arap Cami", "AsmalÄ± Mescit", "Bedrettin", "Cihangir", "Fetihtepe", "GÃ¼mÃ¼ÅŸsuyu", "HalÄ±cÄ±oÄŸlu", "HÃ¼seyinaÄŸa", "Ä°stiklal", "KaptanpaÅŸa", "KarakÃ¶y", "KasÄ±mpaÅŸa", "KulaksÄ±z", "Ã–rnektepe", "Piri PaÅŸa", "SÃ¼tlÃ¼ce", "Åahkulu", "Taksim", "TarlabaÅŸÄ±", "Tomtom"]},
    "BÃ¼yÃ¼kÃ§ekmece": {lat: 41.02, lon: 28.58, n: ["19 MayÄ±s", "Ahmediye", "Alkent 2000", "AtatÃ¼rk", "BatÄ±kÃ¶y", "Celaliye", "Cumhuriyet", "Dizdariye", "Ekinoba", "Fatih", "GÃ¼zelce", "HÃ¼rriyet", "Kamiloba", "Kumburgaz", "Mimaroba", "Mimarsinan", "Murat Ã‡eÅŸme", "PÄ±nartepe", "Sinanoba", "TÃ¼rkoba", "Ulus", "Yenimahalle"]},
    "Ã‡atalca": {lat: 41.14, lon: 28.46, n: ["Akalan", "AydÄ±nlar", "BaÅŸak", "Belgrat", "BinkÄ±lÄ±Ã§", "Ã‡akÄ±l", "Ã‡iftlikkÃ¶y", "DaÄŸyenice", "FerhatpaÅŸa", "GÃ¶kÃ§eali", "Ä°nceÄŸiz", "Ä°zzettin", "KaleiÃ§i", "KaracakÃ¶y", "Kestanelik", "OklalÄ±", "OrmanlÄ±", "Ovayenice", "SubaÅŸÄ±", "YalÄ±kÃ¶y"]},
    "Ã‡ekmekÃ¶y": {lat: 41.03, lon: 29.17, n: ["AlemdaÄŸ", "AydÄ±nlar", "Cumhuriyet", "Ã‡atalmeÅŸe", "EkÅŸioÄŸlu", "GÃ¼ngÃ¶ren", "Hamidiye", "KirazlÄ±dere", "Mehmet Akif", "Merkez", "Mimar Sinan", "NiÅŸantepe", "Ã–merli", "SoÄŸukpÄ±nar", "SultanÃ§iftliÄŸi", "TaÅŸdelen"]},
    "Esenler": {lat: 41.03, lon: 28.89, n: ["Birlik", "Ã‡ifte Havuzlar", "DavutpaÅŸa", "Fatih", "Fevzi Ã‡akmak", "HavaalanÄ±", "KazÄ±m Karabekir", "Kemer", "Menderes", "Mimar Sinan", "NamÄ±k Kemal", "Nene Hatun", "OruÃ§reis", "Tuna", "Turgut Reis", "Yavuz Selim"]},
    "Esenyurt": {lat: 41.03, lon: 28.67, n: ["AkÃ§aburgaz", "Akevler", "AkÅŸemsettin", "ArdÄ±Ã§lÄ±", "AÅŸÄ±k Veysel", "AtatÃ¼rk", "BaÄŸlarÃ§eÅŸme", "BalÄ±kyolu", "Barbaros Hayrettin PaÅŸa", "Battalgazi", "Cumhuriyet", "Ã‡Ä±nar", "Dereyolu", "Fatih", "GÃ¼zelyurt", "HÃ¼rriyet", "Ä°ncirtepe", "Ä°nÃ¶nÃ¼", "Ä°stiklal", "Koza", "Mehmet Akif Ersoy", "Mehtap", "Mevlana", "NamÄ±k Kemal", "Ã–rnek", "Piri Reis", "Saadetdere", "Selahaddin Eyyubi", "Sultaniye", "SÃ¼leymaniye", "TalataÅŸa", "Turgut Ã–zal", "ÃœÃ§evler", "Yenikent", "YeÅŸilkent"]},
    "EyÃ¼psultan": {lat: 41.05, lon: 28.93, n: ["AÄŸaÃ§lÄ±", "AkpÄ±nar", "AkÅŸemsettin", "AlibeykÃ¶y", "Ã‡Ä±rÃ§Ä±r", "Defterdar", "DÃ¼ÄŸmeciler", "Emniyettepe", "Esentepe", "GÃ¶ktÃ¼rk", "GÃ¼zeltepe", "IÅŸÄ±klar", "Ä°hsaniye", "Ä°slambey", "Kemerburgaz", "Mimar Sinan", "MithatpaÅŸa", "NiÅŸancÄ±", "Odayeri", "PirinÃ§Ã§i", "Rami Cuma", "Rami Yeni", "Sakarya", "SilahtaraÄŸa", "TopÃ§ular", "YeÅŸilpÄ±nar"]},
    "Fatih": {lat: 41.01, lon: 28.94, n: ["Aksaray", "Balat", "BeyazÄ±t", "Cankurtaran", "CerrahpaÅŸa", "DerviÅŸ Ali", "EminÃ¶nÃ¼", "Haseki", "KaragÃ¼mrÃ¼k", "KocamustafapaÅŸa", "MevlanakapÄ±", "Samanatya", "Sultanahmet", "Tahtakale", "TopkapÄ±", "Vefa", "Yedikule"]},
    "GaziosmanpaÅŸa": {lat: 41.05, lon: 28.90, n: ["BaÄŸlarbaÅŸÄ±", "Barbaros Hayrettin PaÅŸa", "Fevzi Ã‡akmak", "HÃ¼rriyet", "Karadeniz", "KarayollarÄ±", "KarlÄ±tepe", "KazÄ±m Karabekir", "Merkez", "Mevlana", "PazariÃ§i", "SarÄ±gÃ¶l", "ÅemsipaÅŸa", "YenidoÄŸan", "YÄ±ldÄ±ztabya"]},
    "GÃ¼ngÃ¶ren": {lat: 41.02, lon: 28.87, n: ["Abdurrahman Nafiz GÃ¼rman", "AkÄ±ncÄ±lar", "GenÃ§osman", "GÃ¼neÅŸtepe", "GÃ¼ven", "Haznedar", "MareÅŸal Ã‡akmak", "Mehmet Nesih Ã–zmen", "Merkez", "Sanayi", "Tozkoparan"]},
    "KadÄ±kÃ¶y": {lat: 40.99, lon: 29.02, n: ["19 MayÄ±s", "AcÄ±badem", "BostancÄ±", "Caddebostan", "CaferaÄŸa", "DumlupÄ±nar", "EÄŸitim", "ErenkÃ¶y", "FenerbahÃ§e", "Feneryolu", "Fikirtepe", "GÃ¶ztepe", "HasanpaÅŸa", "KoÅŸuyolu", "KozyataÄŸÄ±", "MerdivenkÃ¶y", "OsmanaÄŸa", "RasimpaÅŸa", "SahrayÄ±cedit", "Suadiye", "ZÃ¼htÃ¼paÅŸa"]},
    "KaÄŸÄ±thane": {lat: 41.08, lon: 28.97, n: ["Ã‡aÄŸlayan", "Ã‡eliktepe", "Emniyet Evleri", "GÃ¼ltepe", "GÃ¼rsel", "Hamidiye", "Harmantepe", "HÃ¼rriyet", "Mehmet Akif Ersoy", "Merkez", "Nurtepe", "OrtabayÄ±r", "Sanayi", "Seyrantepe", "Åirintepe", "TalatpaÅŸa", "Telsizler", "Yahya Kemal", "YeÅŸilce"]},
    "Kartal": {lat: 40.90, lon: 29.19, n: ["Atalar", "Cevizli", "Cumhuriyet", "Ã‡avuÅŸoÄŸlu", "Esentepe", "GÃ¼mÃ¼ÅŸpÄ±nar", "HÃ¼rriyet", "KarlÄ±ktepe", "Kordonboyu", "Orhantepe", "Orta", "Petrol Ä°ÅŸ", "SoÄŸanlÄ±k", "Topselvi", "UÄŸurmumcu", "YakacÄ±k", "YalÄ±", "YukarÄ±"]},
    "KÃ¼Ã§Ã¼kÃ§ekmece": {lat: 41.00, lon: 28.77, n: ["Atakent", "AtatÃ¼rk", "BeÅŸyol", "Cennet", "Cumhuriyet", "Fatih", "Fevzi Ã‡akmak", "GÃ¼ltepe", "HalkalÄ± Merkez", "Ä°nÃ¶nÃ¼", "Ä°stasyon", "Kanarya", "Kartaltepe", "KemalpaÅŸa", "Mehmet Akif", "SÃ¶ÄŸÃ¼tlÃ¼ Ã‡eÅŸme", "Sultan Murat", "Tevfik Bey", "YarÄ±mburgaz", "Yeni Mahalle", "YeÅŸilova"]},
    "Maltepe": {lat: 40.93, lon: 29.14, n: ["AltayÃ§eÅŸme", "AltÄ±ntepe", "AydÄ±nevler", "BaÄŸlarbaÅŸÄ±", "BaÅŸÄ±bÃ¼yÃ¼k", "BÃ¼yÃ¼kbakkalkÃ¶y", "Cevizli", "Ã‡Ä±nar", "Esenkent", "Feyzullah", "FÄ±ndÄ±klÄ±", "Girne", "GÃ¼lensu", "GÃ¼lsuyu", "Ä°dealtepe", "KÃ¼Ã§Ã¼kyalÄ±", "YalÄ±", "ZÃ¼mrÃ¼tevler"]},
    "Pendik": {lat: 40.87, lon: 29.23, n: ["Ahmet Yesevi", "BahÃ§elievler", "BatÄ±", "Ã‡amÃ§eÅŸme", "Ã‡amlÄ±k", "Ã‡Ä±nardere", "DoÄŸu", "DumlupÄ±nar", "ErtuÄŸrul Gazi", "Esenler", "EsenyalÄ±", "Fatih", "Fevzi Ã‡akmak", "GÃ¼llÃ¼ BaÄŸlar", "GÃ¼zelyalÄ±", "Harmandere", "KavakpÄ±nar", "Kaynarca", "KurtkÃ¶y", "Orhangazi", "Orta", "RamanoÄŸlu", "Sapan BaÄŸlarÄ±", "SÃ¼lÃ¼ntepe", "Åeyhli", "Velibaba", "Yayalar", "Yeni Mahalle", "YeniÅŸehir", "YeÅŸilbaÄŸlar"]},
    "Sancaktepe": {lat: 41.00, lon: 29.23, n: ["Abdurrahmangazi", "AkpÄ±nar", "AtatÃ¼rk", "Emek", "EyÃ¼p Sultan", "Fatih", "Hilal", "Ä°nÃ¶nÃ¼", "Meclis", "Merve", "Mevlana", "Osmangazi", "PaÅŸakÃ¶y", "Safa", "SarÄ±gazi", "Veysel Karani", "YenidoÄŸan", "Yunusemre"]},
    "SarÄ±yer": {lat: 41.17, lon: 29.05, n: ["AyazaÄŸa", "BahÃ§ekÃ¶y", "BaltalimanÄ±", "BÃ¼yÃ¼kdere", "Cumhuriyet", "Ã‡ayÄ±rbaÅŸÄ±", "DarÃ¼ÅŸÅŸafaka", "Demirci", "Emirgan", "Fatih Sultan Mehmet", "Ferahevler", "GaripÃ§e", "GÃ¼mÃ¼ÅŸdere", "Huzur", "Ä°stinye", "Kemer", "KÄ±sÄ±rkaya", "KireÃ§burnu", "KocataÅŸ", "KumkÃ¶y", "Madem", "Maslak", "Merkez", "PÄ±nar", "Poligon", "Ptt Evleri", "ReÅŸitpaÅŸa", "Rumelifeneri", "RumelihisarÄ±", "RumelikavaÄŸÄ±", "Tarabya", "UskumrukÃ¶y", "YenikÃ¶y", "ZekeriyakÃ¶y"]},
    "Silivri": {lat: 41.07, lon: 28.24, n: ["Alibey", "AlipaÅŸa", "Bekirli", "Beyciler", "BÃ¼yÃ¼kÃ§avuÅŸlu", "Cumhuriyet", "Ã‡anta", "Ã‡ayÄ±rdere", "DanamandÄ±ra", "Fatih", "Fener", "Gazitepe", "GÃ¼mÃ¼ÅŸyaka", "HÃ¼rriyet", "Ä°smetpaÅŸa", "KadÄ±kÃ¶y", "KavaklÄ±", "Mimarsinan", "OrtakÃ¶y", "Piri Mehmet PaÅŸa", "Sancaktar", "Sayalar", "SelimpaÅŸa", "Semizkumlar", "Yenimahalle"]},
    "Sultanbeyli": {lat: 40.96, lon: 29.26, n: ["Abdurrahmangazi", "Adil", "Ahmet Yesevi", "AkÅŸemsettin", "Battalgazi", "Fatih", "Hamidiye", "HasanpaÅŸa", "Mecidiye", "Mehmet Akif", "Mimar Sinan", "Necip FazÄ±l", "Orhangazi", "Turgut Reis", "Yavuz Selim"]},
    "Sultangazi": {lat: 41.10, lon: 28.86, n: ["50. YÄ±l", "75. YÄ±l", "Cebeci", "Cumhuriyet", "Esentepe", "Eski Habipler", "Gazi", "Habipler", "Ä°smetpaÅŸa", "MalkoÃ§oÄŸlu", "SultanÃ§iftliÄŸi", "UÄŸur Mumcu", "Yayla", "Yunusemre", "ZÃ¼beyde HanÄ±m"]},
    "Åile": {lat: 41.17, lon: 29.61, n: ["AÄŸva", "Ahmetli", "AlacalÄ±", "AvcÄ±koru", "Balibey", "BÄ±Ã§kÄ±dere", "Bozhane", "Ã‡avuÅŸ", "DarlÄ±k", "HacÄ±kasÄ±m", "Ä°mrenli", "Karakiraz", "Kumbaba", "KurfallÄ±", "MeÅŸrutiyet", "OvacÄ±k", "SahilkÃ¶y", "TekekÃ¶y", "Ãœvezli", "YenikÃ¶y"]},
    "ÅiÅŸli": {lat: 41.06, lon: 28.98, n: ["19 MayÄ±s", "Bozkurt", "Cumhuriyet", "Duatepe", "Ergenekon", "Esentepe", "EskiÅŸehir", "FerikÃ¶y", "Fulya", "GÃ¼lbahar", "Halaskargazi", "Halide Edip AdÄ±var", "Halil RÄ±fat PaÅŸa", "Harbiye", "Ä°nÃ¶nÃ¼", "Ä°zzet PaÅŸa", "KaptanpaÅŸa", "KuÅŸtepe", "Mahmut Åevket PaÅŸa", "MecidiyekÃ¶y", "Merkez", "MeÅŸrutiyet", "PaÅŸa", "TeÅŸvikiye", "Yayla"]},
    "Tuzla": {lat: 40.81, lon: 29.30, n: ["AkfÄ±rat", "Anadolu", "AydÄ±nlÄ±", "Cami", "Evliya Ã‡elebi", "Fatih", "Ä°Ã§meler", "Ä°stasyon", "Mescit", "Mimar Sinan", "OrhanlÄ±", "Orta", "Postane", "Åifa", "TepeÃ¶ren", "Yayla"]},
    "Ãœmraniye": {lat: 41.02, lon: 29.10, n: ["Adem Yavuz", "AltÄ±nÅŸehir", "ArmaÄŸanevler", "AÅŸaÄŸÄ± Dudullu", "Atakent", "AtatÃ¼rk", "Cemil MeriÃ§", "Ã‡akmak", "Ã‡amlÄ±k", "DumlupÄ±nar", "ElmalÄ±kent", "Esenevler", "EsenÅŸehir", "Fatih Sultan Mehmet", "HekimbaÅŸÄ±", "Huzur", "Ihlamurkuyu", "Ä°nkÄ±lap", "Ä°stiklal", "KazÄ±m Karabekir", "Madenler", "Mehmet Akif", "NamÄ±k Kemal", "Necip FazÄ±l", "Parseller", "Åerifali", "Site", "Tantavi", "TatlÄ±su", "TepeÃ¼stÃ¼", "TopaÄŸacÄ±", "Yamanevler", "YeniÅŸehir", "YukarÄ± Dudullu"]},
    "ÃœskÃ¼dar": {lat: 41.02, lon: 29.01, n: ["AcÄ±badem", "Ahmediye", "Altunizade", "Aziz Mahmud HÃ¼dayi", "BahÃ§elievler", "Barbaros", "Beylerbeyi", "Bulgurlu", "Burhaniye", "Cumhuriyet", "Ã‡engelkÃ¶y", "Ferah", "GÃ¼zeltepe", "Ä°cladiye", "Kandilli", "Kuleli", "Kuzguncuk", "KÃ¼Ã§Ã¼k Ã‡amlÄ±ca", "KÃ¼Ã§Ã¼ksu", "Kuleli", "KirazlÄ±tepe", "Mehmet Akif Ersoy", "Mimar Sinan", "Murat Reis", "Salacak", "Selami Ali", "Selimiye", "Sultantepe", "Ãœnalan", "YavuztÃ¼rk", "Zeynep Kamil"]},
    "Zeytinburnu": {lat: 40.99, lon: 28.90, n: ["BeÅŸtelsiz", "Ã‡Ä±rpÄ±cÄ±", "GÃ¶kalp", "KazlÄ±Ã§eÅŸme", "Maltepe", "Merkezefendi", "NuripaÅŸa", "Seyitnizam", "SÃ¼mer", "Telsiz", "Veliefendi", "YenidoÄŸan", "YeÅŸiltepe"]}
};

let myChart;
const districtSelect = document.getElementById('districts');
const neighborhoodSelect = document.getElementById('neighborhoods');

// BaÅŸlangÄ±Ã§
window.onload = () => {
    // Ä°lÃ§eleri alfabetik sÄ±ralayalÄ±m
    const sortedDistricts = Object.keys(data).sort((a, b) => a.localeCompare(b, 'tr'));
    
    sortedDistricts.forEach(d => {
        let opt = new Option(d, d);
        districtSelect.add(opt);
    });
    updateNeighborhoods();
};

function updateNeighborhoods() {
    const d = districtSelect.value;
    neighborhoodSelect.innerHTML = '';
    // Mahalleleri alfabetik sÄ±ralayalÄ±m
    const sortedNeighborhoods = data[d].n.sort((a, b) => a.localeCompare(b, 'tr'));
    
    sortedNeighborhoods.forEach(nh => {
        neighborhoodSelect.add(new Option(nh, nh));
    });
    fetchWeather();
}

async function fetchWeather() {
    const d = districtSelect.value;
    const {lat, lon} = data[d];
    const url = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current=temperature_2m,relative_humidity_2m,apparent_temperature,weather_code,wind_speed_10m&hourly=temperature_2m&daily=weather_code,temperature_2m_max,temperature_2m_min,uv_index_max&timezone=Europe%2FIstanbul`;

    try {
        const res = await fetch(url);
        if(!res.ok) throw new Error();
        const json = await res.json();
        updateUI(json);
    } catch (e) {
        alert("Hava durumu verisi ÅŸu an alÄ±namÄ±yor.");
    }
}

function updateUI(json) {
    const current = json.current;
    document.getElementById('loc-name').innerText = `${neighborhoodSelect.value}, ${districtSelect.value}`;
    document.getElementById('current-temp').innerText = `${Math.round(current.temperature_2m)}Â°`;
    document.getElementById('feel-temp').innerText = `${Math.round(current.apparent_temperature)}Â°`;
    document.getElementById('humidity').innerText = `%${current.relative_humidity_2m}`;
    document.getElementById('wind').innerText = `${current.wind_speed_10m} km/s`;
    document.getElementById('uv').innerText = json.daily.uv_index_max[0];
    
    const code = current.weather_code;
    document.getElementById('weather-desc').innerText = getWeatherDesc(code);
    
    updateChart(json.hourly);
    updateForecast(json.daily);
    setAnimations(code);
}

function getWeatherDesc(code) {
    if (code === 0) return "AÃ§Ä±k GÃ¶kyÃ¼zÃ¼";
    if (code <= 3) return "ParÃ§alÄ± Bulutlu";
    if (code <= 48) return "Sisli";
    if (code <= 67) return "YaÄŸmurlu";
    if (code <= 77) return "Kar YaÄŸÄ±ÅŸlÄ±";
    if (code <= 82) return "SaÄŸanak YaÄŸÄ±ÅŸ";
    return "FÄ±rtÄ±na";
}

function updateChart(hourly) {
    const ctx = document.getElementById('hourlyChart').getContext('2d');
    if (myChart) myChart.destroy();
    
    myChart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: hourly.time.slice(0, 24).map(t => t.split('T')[1]),
            datasets: [{
                label: 'SÄ±caklÄ±k (Â°C)',
                data: hourly.temperature_2m.slice(0, 24),
                borderColor: '#fff',
                backgroundColor: 'rgba(255,255,255,0.2)',
                fill: true,
                tension: 0.4
            }]
        },
        options: {
            responsive: true,
            plugins: { legend: { display: false } },
            scales: {
                x: { ticks: { color: '#fff' }, grid: { display: false } },
                y: { ticks: { color: '#fff' }, grid: { color: 'rgba(255,255,255,0.1)' } }
            }
        }
    });
}

function updateForecast(daily) {
    const container = document.getElementById('forecast');
    container.innerHTML = '';
    const emojis = {0: 'â˜€ï¸', 1: 'ğŸŒ¤ï¸', 2: 'â›…', 3: 'â˜ï¸', 45: 'ğŸŒ«ï¸', 61: 'ğŸŒ§ï¸', 71: 'â„ï¸', 95: 'â›ˆï¸'};

    for(let i=0; i<7; i++) {
        const date = new Date(daily.time[i]).toLocaleDateString('tr', {weekday: 'short'});
        const div = document.createElement('div');
        div.className = 'forecast-item';
        div.innerHTML = `
            <div>${date}</div>
            <div style="font-size:24px; margin:8px 0">${emojis[daily.weather_code[i]] || 'â˜ï¸'}</div>
            <b>${Math.round(daily.temperature_2m_max[i])}Â°</b>
            <div style="font-size:12px; opacity:0.7">${Math.round(daily.temperature_2m_min[i])}Â°</div>
        `;
        container.appendChild(div);
    }
}

function setAnimations(code) {
    const container = document.getElementById('weather-anim');
    container.innerHTML = '';
    
    let type = '';
    if (code >= 51 && code <= 67 || code >= 80) type = 'drop';
    if (code >= 71 && code <= 77) type = 'snow';

    if (type) {
        for (let i = 0; i < 50; i++) {
            const el = document.createElement('div');
            el.className = type;
            el.style.left = Math.random() * 100 + 'vw';
            el.style.animationDuration = (Math.random() * 1 + 0.5) + 's';
            el.style.animationDelay = Math.random() * 2 + 's';
            container.appendChild(el);
        }
    }
}
                                            </script>
                                            
