<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ƒ∞stanbul Hava Durumu Pro</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
*{margin:0;padding:0;box-sizing:border-box;}
html,body{height:100%;width:100%;font-family:'Inter',sans-serif;overflow-x:hidden;transition:background 1s;}
body{display:flex;flex-direction:column;align-items:center;padding:20px;background:linear-gradient(135deg,#c3f0fc,#f0f9ff);color:#333;position:relative;}
h1{text-align:center;font-size:2rem;font-weight:900;margin-bottom:15px;color:#222;}
select{padding:10px 15px;font-size:16px;border-radius:12px;border:none;outline:none;margin-bottom:20px;background:rgba(255,255,255,0.8);color:#222;}
.weather-card{width:90%;max-width:400px;background:rgba(255,255,255,0.9);border-radius:25px;padding:25px 20px;text-align:center;margin-bottom:25px;box-shadow:0 10px 30px rgba(0,0,0,0.1);}
.temp{font-size:5rem;font-weight:900;margin:10px 0;color:#ff6b6b;}
.desc{font-size:1.5rem;margin-bottom:10px;}
.extra-info{display:flex;justify-content:space-around;flex-wrap:wrap;margin-top:15px;font-size:0.95rem;color:#555;}
.extra-info div{background:rgba(240,240,240,0.6);padding:8px 12px;margin:5px;border-radius:15px;flex:1 1 40%;text-align:center;}
.forecast-week{display:flex;overflow-x:auto;gap:10px;width:100%;padding-bottom:10px;}
.day-card{min-width:80px;background:rgba(255,255,255,0.7);border-radius:15px;padding:10px;text-align:center;flex-shrink:0;box-shadow:0 4px 15px rgba(0,0,0,0.1);}
.day-card div{margin:5px 0;font-size:0.95rem;}
canvas{max-width:95%;margin-top:15px;}
/* Animasyonlar */
.rain, .snow{position:absolute;width:100%;height:100%;top:0;left:0;pointer-events:none;z-index:0;}
.raindrop{position:absolute;width:2px;height:10px;background:rgba(0,0,0,0.2);animation:fall 1s linear infinite;}
@keyframes fall{0%{top:-10px;}100%{top:100%;}}
.snowflake{position:absolute;width:5px;height:5px;background:#fff;border-radius:50%;animation:snowfall linear infinite;}
@keyframes snowfall{0%{top:-10px;}100%{top:100%;}}
@media(max-width:480px){.temp{font-size:3.5rem;}h1{font-size:1.5rem;}}
</style>
</head>
<body>
<h1>ƒ∞stanbul Hava Durumu Pro</h1>

<select id="districtSelect"><option value="">ƒ∞l√ße Se√ßin</option></select>
<select id="neighborhoodSelect"><option value="">Mahalle Se√ßin</option></select>

<div class="weather-card" id="weatherCard" style="display:none;">
  <div class="desc" id="weatherDesc"></div>
  <div class="temp" id="temp"></div>
  <div class="extra-info">
    <div>Hissedilen: <span id="feelsLike"></span>¬∞C</div>
    <div>Nem: <span id="humidity"></span>%</div>
    <div>R√ºzgar: <span id="wind"></span> m/s</div>
    <div>UV: <span id="uv"></span></div>
  </div>
</div>

<div class="forecast-week" id="forecastWeek"></div>
<canvas id="hourlyChart"></canvas>

<div class="rain" id="rainLayer"></div>
<div class="snow" id="snowLayer"></div>

<script>
// ƒ∞stanbul 39 ƒ∞l√ße ve √∂rnek √∂nemli mahalleler
const districts=[
  { name:"Adalar",lat:40.8691,lon:29.1167, neighborhoods:["Burgazada","Heybeliada","Kƒ±nalƒ±ada","B√ºy√ºkada"]},
  { name:"Kadƒ±k√∂y",lat:40.9900,lon:29.0270, neighborhoods:["Fenerbah√ße","Moda","Suadiye","Acƒ±badem","Kozyataƒüƒ±"]},
  { name:"Be≈üikta≈ü",lat:41.0435,lon:29.0090, neighborhoods:["Levent","Ortak√∂y","Etiler","Kuru√ße≈üme","Bebek"]},
  { name:"Bakƒ±rk√∂y",lat:40.9810,lon:28.8720, neighborhoods:["Cevizlik","Kartaltepe","Florya","Ye≈üilk√∂y"]},
  { name:"√úsk√ºdar",lat:41.0170,lon:29.0280, neighborhoods:["Altunizade","Beylerbeyi","√áengelk√∂y","Kƒ±sƒ±klƒ±","√úsk√ºdar Merkez"]},
  { name:"≈ûi≈üli",lat:41.0610,lon:28.9870, neighborhoods:["Mecidiyek√∂y","Ni≈üanta≈üƒ±","Harbiye","≈ûi≈üli Merkez"]},
  { name:"Fatih",lat:41.0145,lon:28.9490, neighborhoods:["Aksaray","Fener","Sultanahmet","Emin√∂n√º","Cankurtaran"]},
  { name:"Bakƒ±rk√∂y",lat:40.9810,lon:28.8720, neighborhoods:["Ye≈üilk√∂y","Florya","Cevizlik"]},
  // ... diƒüer il√ßeler i√ßin de benzer ≈üekilde ekleyebilirsin
];

// Weather Code Map
const weatherCodeMap={0:["A√ßƒ±k","‚òÄÔ∏è"],1:["Par√ßalƒ± Bulutlu","‚õÖÔ∏è"],2:["Bulutlu","‚òÅÔ∏è"],3:["Yaƒümurlu","üåßÔ∏è"],45:["Sisli","üå´Ô∏è"],48:["Sisli","üå´Ô∏è"],51:["√áiseleyen Yaƒümur","üå¶Ô∏è"],53:["√áiseleyen Yaƒümur","üå¶Ô∏è"],55:["√áiseleyen Yaƒümur","üå¶Ô∏è"],61:["Yaƒümur","üåßÔ∏è"],63:["Yoƒüun Yaƒümur","üåßÔ∏è"],65:["Yoƒüun Yaƒümur","üåßÔ∏è"],71:["Kar","‚ùÑÔ∏è"],73:["Yoƒüun Kar","‚ùÑÔ∏è"],75:["Yoƒüun Kar","‚ùÑÔ∏è"],80:["Saƒüanak","üåßÔ∏è"],81:["Yoƒüun Saƒüanak","üåßÔ∏è"],82:["Yoƒüun Saƒüanak","üåßÔ∏è"],95:["Fƒ±rtƒ±na","‚õàÔ∏è"]};

const districtSelect=document.getElementById('districtSelect');
const neighborhoodSelect=document.getElementById('neighborhoodSelect');

districts.forEach(d=>{const o=document.createElement('option');o.value=d.name;o.textContent=d.name;districtSelect.appendChild(o);});

districtSelect.addEventListener('change',()=>{
  neighborhoodSelect.innerHTML='<option value="">Mahalle Se√ßin</option>';
  const d=districts.find(x=>x.name===districtSelect.value);
  if(d) d.neighborhoods.forEach(n=>{
    const o=document.createElement('option');o.value=n;o.textContent=n;neighborhoodSelect.appendChild(o);
  });
});

let chart=null;
neighborhoodSelect.addEventListener('change',()=>{
  const d=districts.find(x=>x.name===districtSelect.value);
  if(d && neighborhoodSelect.value) getWeather(d.lat,d.lon);
});

async function getWeather(lat,lon){
try{
  const res=await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true&hourly=temperature_2m,uv_index,relativehumidity_2m&daily=temperature_2m_max,temperature_2m_min,weathercode&timezone=Europe/Istanbul`);
  if(!res.ok) throw new Error("Veri alƒ±namadƒ±");
  const data=await res.json();

  const current=data.current_weather;
  const code=current.weathercode;
  const [desc,emoji]=weatherCodeMap[code]?weatherCodeMap[code]:["Bilinmiyor","‚ùì"];

  document.getElementById('weatherCard').style.display='block';
  document.getElementById('weatherDesc').textContent=emoji+" "+desc;
  document.getElementById('temp').textContent=current.temperature+"¬∞C";
  document.getElementById('feelsLike').textContent=current.temperature;
  document.getElementById('humidity').textContent=data.hourly.relativehumidity_2m?data.hourly.relativehumidity_2m[0]:"N/A";
  document.getElementById('wind').textContent=current.windspeed;
  document.getElementById('uv').textContent=data.hourly.uv_index?data.hourly.uv_index[0]:"N/A";

  // 7 G√ºnl√ºk Tahmin
  const weekDiv=document.getElementById('forecastWeek'); weekDiv.innerHTML="";
  for(let i=0;i<data.daily.time.length;i++){
    const c=data.daily.weathercode[i];
    const [dEmoji,dDesc]=weatherCodeMap[c]?weatherCodeMap[c]:["‚ùì","Bilinmiyor"];
    const card=document.createElement('div'); card.className='day-card';
    const date=new Date(data.daily.time[i]);
    const days=["Paz","Pzt","Sal","√áar","Per","Cum","Cmt"];
    card.innerHTML=`<div>${days[date.getDay()]}</div><div style="font-size:1.8rem">${dEmoji}</div><div>${Math.round(data.daily.temperature_2m_max[i])}¬∞</div>`;
    weekDiv.appendChild(card);
  }

  // 24 Saatlik Grafik
  const hours=data.hourly.time.slice(0,24).map(t=>t.split("T")[1].slice(0,5));
  const temps=data.hourly.temperature_2m.slice(0,24);
  if(chart) chart.destroy();
  const ctx=document.getElementById('hourlyChart').getContext('2d');
  chart=new Chart(ctx,{
    type:'line',
    data:{labels:hours,datasets:[{label:'Sƒ±caklƒ±k (¬∞C)',data:temps,borderColor:'#ff6b6b',backgroundColor:'rgba(255,107,107,0.2)',fill:true,tension:0.4,pointRadius:3}]},
    options:{responsive:true,plugins:{legend:{display:false}},scales:{y:{beginAtZero:false}}}
  });

  // Animasyonlar
  const rainLayer=document.getElementById('rainLayer');
  const snowLayer=document.getElementById('snowLayer');
  rainLayer.innerHTML=''; snowLayer.innerHTML='';
  if([2,3,51,53,55,61,63,65,80,81,82].includes(code)){addRain();}
  else if([71,73,75].includes(code)){addSnow();}

}catch(err){alert("Hava durumu verisi alƒ±namadƒ±."); console.error(err);}
}

function addRain(){const rainLayer=document.getElementById('rainLayer');for(let i=0;i<100;i++){const d=document.createElement('div');d.className='raindrop';d.style.left=Math.random()*100+'%';d.style.animationDuration=0.5+Math.random()*0.5+'s';d.style.height=5+Math.random()*10+'px';rainLayer.appendChild(d);}}
function addSnow(){const snowLayer=document.getElementById('snowLayer');for(let i=0;i<50;i++){const s=document.createElement('div');s.className='snowflake';s.style.left=Math.random()*100+'%';s.style.animationDuration=5+Math.random()*5+'s';s.style.width=2+Math.random()*5+'px';s.style.height=2+Math.random()*5+'px';snowLayer.appendChild(s);}}
</script>
</body>
</html>
