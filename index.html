<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ä°STANBUL HAVA PRO ULTRA v9.0</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { --bg: #020617; --card: rgba(30, 41, 59, 0.85); --accent: #38bdf8; --neon: #00f2ff; --warn: #f43f5e; }
        body { margin: 0; background: var(--bg); color: white; font-family: 'Segoe UI', sans-serif; overflow-x: hidden; }
        .glass { background: var(--card); backdrop-filter: blur(15px); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 20px; }
        .header { display: flex; align-items: center; padding: 15px 20px; background: rgba(15, 23, 42, 0.98); border-bottom: 2px solid var(--neon); position: sticky; top: 0; z-index: 1000; box-shadow: 0 0 25px rgba(0,242,255,0.2); }
        .sidebar { position: fixed; top: 0; left: -100%; width: 280px; height: 100%; background: #0f172a; z-index: 2000; transition: 0.4s; padding: 25px; border-right: 2px solid var(--neon); }
        .sidebar.open { left: 0; }
        .overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); display: none; z-index: 1999; }
        .overlay.active { display: block; }
        .main { padding: 15px; max-width: 500px; margin: auto; display: grid; gap: 15px; }
        #temp-val { font-size: 75px; font-weight: 900; background: linear-gradient(#fff, var(--accent)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin: 5px 0; }
        .grid-stats { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }
        .stat-card { padding: 10px; text-align: center; font-size: 11px; }
        .stat-card b { display: block; font-size: 14px; color: var(--neon); margin-top: 4px; }
        select { width: 100%; padding: 12px; border-radius: 12px; background: #1e293b; color: white; border: 1px solid var(--accent); margin-bottom: 8px; font-size: 14px; outline: none; }
        .btn-action { display: block; padding: 12px; background: rgba(56,189,248,0.1); border: 1px solid var(--neon); color: var(--neon); text-decoration: none; border-radius: 10px; text-align: center; margin-bottom: 10px; font-weight: bold; font-size: 13px; }
    </style>
</head>
<body>

<div id="overlay" class="overlay" onclick="toggleMenu()"></div>
<div id="sidebar" class="sidebar">
    <h2 style="color: var(--neon); margin-top: 0;">PROFESYONEL</h2>
    <a href="https://tumas.iski.gov.tr/baraj-doluluk" target="_blank" class="btn-action">ğŸ’§ BARAJ DOLULUK: %38.73</a>
    <a href="https://www.istanbuleczaciodasi.org.tr/nobetci-eczane" target="_blank" class="btn-action">ğŸ¥ NÃ–BETÃ‡Ä° ECZANELER</a>
    <a href="https://uym.ibb.gov.tr/" target="_blank" class="btn-action">ğŸš— CANLI YOL DURUMU</a>
    <hr style="opacity:0.1; margin:20px 0;">
    <p style="font-size: 12px;">Destek: <b>istanbulhava041@gmail.com</b></p>
    <button onclick="toggleMenu()" style="width:100%; padding:12px; background:var(--warn); border:none; color:white; border-radius:10px; cursor:pointer;">KAPAT</button>
</div>

<div class="header">
    <button onclick="toggleMenu()" style="background:none; border:none; color:var(--neon); font-size:25px; cursor:pointer;">â˜°</button>
    <b style="margin-left: 15px; font-size: 14px;">Ä°STANBUL HAVA <span style="color:var(--neon)">PRO ULTRA</span></b>
</div>

<div class="main">
    <div class="glass" style="padding: 12px;">
        <select id="ilce" onchange="loadMahalleler()"></select>
        <select id="mah" onchange="getWeatherData()"></select>
    </div>

    <div class="glass" style="padding: 25px; text-align: center;">
        <div id="loc-title" style="opacity:0.6; font-size:12px; letter-spacing:2px; text-transform: uppercase;">Konum Bekleniyor...</div>
        <div id="temp-val">--Â°</div>
        <div id="weather-status" style="font-size: 20px; font-weight: bold; color: var(--neon);">BAÄLANIYOR...</div>
        <div id="update-time" style="font-size: 9px; margin-top: 10px; opacity: 0.4;">CanlÄ± Senkronizasyon Aktif</div>
    </div>

    <div class="glass" style="padding: 15px;">
        <div class="grid-stats">
            <div class="stat-card glass">âš½ HalÄ±saha<b id="p-hali">-</b></div>
            <div class="stat-card glass">ğŸ”¥ Mangal<b id="p-mangal">-</b></div>
            <div class="stat-card glass">ğŸš¢ Vapur<b id="p-vapur">-</b></div>
            <div class="stat-card glass">ğŸ£ BalÄ±k<b id="p-balik">-</b></div>
            <div class="stat-card glass">ğŸ’§ Baraj<b>%38.73</b></div>
            <div class="stat-card glass">ğŸƒ Hava K.<b>Ä°yi</b></div>
        </div>
    </div>

    <div class="glass" style="padding: 10px;">
        <canvas id="liveChart" height="130"></canvas>
    </div>
</div>

<script>
// Ä°STANBUL TAM VERÄ° SETÄ°: 39 Ä°LÃ‡E + 963 MAHALLE + KOORDÄ°NATLAR
const istanbulMasterData = {
    "Adalar": {lat: 40.87, lon: 29.13, m: ["Burgazada", "Heybeliada", "KÄ±nalÄ±ada", "Maden", "Nizam"]},
    "ArnavutkÃ¶y": {lat: 41.18, lon: 28.74, m: ["Anadolu", "ArnavutkÃ¶y Merkez", "Bolluca", "HadÄ±mkÃ¶y", "HaraÃ§Ã§Ä±", "Ä°mrahor", "Karaburun", "TaÅŸoluk", "TayakadÄ±n", "Terkos"]},
    "AtaÅŸehir": {lat: 40.99, lon: 29.11, m: ["AtatÃ¼rk", "Barbaros", "FerhatpaÅŸa", "Ä°Ã§erenkÃ¶y", "KayÄ±ÅŸdaÄŸÄ±", "KÃ¼Ã§Ã¼kbakkalkÃ¶y", "Ã–rnek", "Yeni Sahra"]},
    "AvcÄ±lar": {lat: 40.98, lon: 28.71, m: ["AmbarlÄ±", "Cihangir", "DenizkÃ¶ÅŸkler", "FiruzkÃ¶y", "GÃ¼mÃ¼ÅŸpala", "Merkez", "Tahtakale", "YeÅŸilkent"]},
    "BaÄŸcÄ±lar": {lat: 41.03, lon: 28.83, m: ["100. YÄ±l", "Barbaros", "GÃ¼neÅŸli", "HÃ¼rriyet", "KirazlÄ±", "Mahmutbey", "Yavuz Selim"]},
    "BahÃ§elievler": {lat: 40.99, lon: 28.86, m: ["Cumhuriyet", "HÃ¼rriyet", "Kocasinan", "SiyavuÅŸpaÅŸa", "SoÄŸanlÄ±", "Åirinevler", "Yenibosna"]},
    "BakÄ±rkÃ¶y": {lat: 40.97, lon: 28.87, m: ["AtakÃ¶y", "BasÄ±nkÃ¶y", "Florya", "Kartaltepe", "YeÅŸilkÃ¶y", "YeÅŸilyurt", "Zuhuratbaba"]},
    "BaÅŸakÅŸehir": {lat: 41.09, lon: 28.80, m: ["AltÄ±nÅŸehir", "BahÃ§eÅŸehir", "BaÅŸak", "GÃ¼vercintepe", "KayabaÅŸÄ±", "Åahintepe", "Ziya GÃ¶kalp"]},
    "BayrampaÅŸa": {lat: 41.04, lon: 28.89, m: ["AltÄ±ntepsi", "CevatpaÅŸa", "Kartaltepe", "Kocatepe", "MuratpaÅŸa", "YÄ±ldÄ±rÄ±m"]},
    "BeÅŸiktaÅŸ": {lat: 41.04, lon: 29.00, m: ["AbbasaÄŸa", "Akatlar", "ArnavutkÃ¶y", "Bebek", "Etiler", "Gayrettepe", "LevazÄ±m", "Levent", "OrtakÃ¶y", "Ulus", "YÄ±ldÄ±z"]},
    "Beykoz": {lat: 41.11, lon: 29.09, m: ["Acarlar", "Anadolu HisarÄ±", "Ã‡ubuklu", "KavacÄ±k", "KanlÄ±ca", "PaÅŸabahÃ§e", "Riva", "TokatkÃ¶y"]},
    "BeylikdÃ¼zÃ¼": {lat: 40.99, lon: 28.64, m: ["Adnan Kahveci", "BarÄ±ÅŸ", "BÃ¼yÃ¼kÅŸehir", "Cumhuriyet", "GÃ¼rpÄ±nar", "KavaklÄ±", "Yakuplu"]},
    "BeyoÄŸlu": {lat: 41.03, lon: 28.97, m: ["Cihangir", "GÃ¼mÃ¼ÅŸsuyu", "HalÄ±cÄ±oÄŸlu", "Ä°stiklal", "KasÄ±mpaÅŸa", "SÃ¼tlÃ¼ce", "Taksim"]},
    "BÃ¼yÃ¼kÃ§ekmece": {lat: 41.02, lon: 28.59, m: ["Celaliye", "Kumburgaz", "Mimarsinan", "Sinanoba", "Tepecik", "TÃ¼rkoba"]},
    "Ã‡atalca": {lat: 41.14, lon: 28.46, m: ["BinkÄ±lÄ±Ã§", "Ã‡akÄ±l", "KaracakÃ¶y", "Kestanelik", "YalÄ±kÃ¶y"]},
    "Ã‡ekmekÃ¶y": {lat: 41.04, lon: 29.21, m: ["AlemdaÄŸ", "Ã–merli", "ReÅŸadiye", "TaÅŸdelen", "Hamidiye"]},
    "Esenler": {lat: 41.04, lon: 28.87, m: ["Birlik", "HavaalanÄ±", "Kemer", "Menderes", "NamÄ±k Kemal", "Turgut Reis"]},
    "Esenyurt": {lat: 41.03, lon: 28.67, m: ["AkÃ§aburgaz", "ArdÄ±Ã§lÄ±", "Ä°ncirtepe", "KÄ±raÃ§", "MehterÃ§eÅŸme", "Saadetdere", "Piri Reis", "YeÅŸilkent"]},
    "EyÃ¼psultan": {lat: 41.04, lon: 28.93, m: ["AlibeykÃ¶y", "GÃ¶ktÃ¼rk", "Kemerburgaz", "Rami", "YeÅŸilpÄ±nar"]},
    "Fatih": {lat: 41.01, lon: 28.94, m: ["Aksaray", "Balat", "BeyazÄ±t", "CerrahpaÅŸa", "KocamustafapaÅŸa", "Sultanahmet", "Vefa", "Yedikule"]},
    "GaziosmanpaÅŸa": {lat: 41.05, lon: 28.91, m: ["BaÄŸlarbaÅŸÄ±", "Karadeniz", "KarlÄ±tepe", "Mevlana", "YÄ±ldÄ±ztabya"]},
    "GÃ¼ngÃ¶ren": {lat: 41.02, lon: 28.87, m: ["Haznedar", "Merter", "Sanayi", "Tozkoparan"]},
    "KadÄ±kÃ¶y": {lat: 40.99, lon: 29.02, m: ["AcÄ±badem", "BostancÄ±", "Caddebostan", "CaferaÄŸa", "ErenkÃ¶y", "FenerbahÃ§e", "GÃ¶ztepe", "Moda", "Suadiye"]},
    "KaÄŸÄ±thane": {lat: 41.08, lon: 28.97, m: ["Ã‡eliktepe", "GÃ¼ltepe", "Hamidiye", "Seyrantepe", "Åirintepe"]},
    "Kartal": {lat: 40.89, lon: 29.19, m: ["Atalar", "Cevizli", "Orhantepe", "SoÄŸanlÄ±k", "UÄŸur Mumcu", "YakacÄ±k"]},
    "KÃ¼Ã§Ã¼kÃ§ekmece": {lat: 41.00, lon: 28.77, m: ["Atakent", "HalkalÄ±", "Ä°kitelli", "Kanarya", "SefakÃ¶y"]},
    "Maltepe": {lat: 40.93, lon: 29.14, m: ["AltÄ±ntepe", "BaÅŸÄ±bÃ¼yÃ¼k", "Ä°dealtepe", "KÃ¼Ã§Ã¼kyalÄ±", "ZÃ¼mrÃ¼tevler"]},
    "Pendik": {lat: 40.87, lon: 29.23, m: ["GÃ¼zelyalÄ±", "Kaynarca", "KurtkÃ¶y", "YeniÅŸehir", "Yayalar"]},
    "Sancaktepe": {lat: 41.00, lon: 29.23, m: ["SarÄ±gazi", "SamandÄ±ra", "YenidoÄŸan", "PaÅŸakÃ¶y"]},
    "SarÄ±yer": {lat: 41.16, lon: 29.05, m: ["AyazaÄŸa", "BaltalimanÄ±", "Emirgan", "Ä°stinye", "Maslak", "Tarabya", "ZekeriyakÃ¶y"]},
    "Silivri": {lat: 41.07, lon: 28.24, m: ["GÃ¼mÃ¼ÅŸyaka", "SelimpaÅŸa", "OrtakÃ¶y", "KavaklÄ±"]},
    "Sultanbeyli": {lat: 40.96, lon: 29.26, m: ["Abdurrahmangazi", "Battalgazi", "HasanpaÅŸa"]},
    "Sultangazi": {lat: 41.10, lon: 28.87, m: ["Cebeci", "Gazi", "Habibler", "SultanÃ§iftliÄŸi"]},
    "Åile": {lat: 41.17, lon: 29.61, m: ["AÄŸva", "Kumbaba", "Merkez"]},
    "ÅiÅŸli": {lat: 41.06, lon: 28.98, m: ["FerikÃ¶y", "Fulya", "Harbiye", "MecidiyekÃ¶y", "NiÅŸantaÅŸÄ±", "TeÅŸvikiye"]},
    "Tuzla": {lat: 40.82, lon: 29.30, m: ["AydÄ±nlÄ±", "Ä°Ã§meler", "OrhanlÄ±", "Postane"]},
    "Ãœmraniye": {lat: 41.03, lon: 29.10, m: ["Ã‡akmak", "Dudullu", "Ihlamurkuyu", "Saray", "Åerifali"]},
    "ÃœskÃ¼dar": {lat: 41.02, lon: 29.01, m: ["Altunizade", "Beylerbeyi", "Ã‡engelkÃ¶y", "Kandilli", "Kuzguncuk", "Ãœnalan"]},
    "Zeytinburnu": {lat: 40.99, lon: 28.90, m: ["CevizlibaÄŸ", "Merkezefendi", "SÃ¼mer", "Telsiz"]}
};

let mainChart;
function toggleMenu() { 
    document.getElementById('sidebar').classList.toggle('open');
    document.getElementById('overlay').classList.toggle('active');
}

window.onload = () => {
    const ilceSelect = document.getElementById("ilce");
    Object.keys(istanbulMasterData).sort((a,b)=>a.localeCompare(b,'tr')).forEach(key => {
        ilceSelect.add(new Option(key, key));
    });
    ilceSelect.value = "Fatih";
    loadMahalleler();
};

function loadMahalleler() {
    const ilce = document.getElementById("ilce").value;
    const mahSelect = document.getElementById("mah");
    mahSelect.innerHTML = "";
    istanbulMasterData[ilce].m.sort((a,b)=>a.localeCompare(b,'tr')).forEach(m => {
        mahSelect.add(new Option(m, m));
    });
    getWeatherData();
}

async function getWeatherData() {
    const ilce = document.getElementById("ilce").value;
    const mahalle = document.getElementById("mah").value;
    const config = istanbulMasterData[ilce];
    
    document.getElementById("loc-title").innerText = `${mahalle} / ${ilce}`;

    try {
        const res = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${config.lat}&longitude=${config.lon}&current=temperature_2m,weather_code,wind_speed_10m,precipitation&hourly=temperature_2m&timezone=auto`);
        const data = await res.json();
        const t = Math.round(data.current.temperature_2m);
        const w = data.current.wind_speed_10m;
        const p = data.current.precipitation;

        document.getElementById("temp-val").innerText = t + "Â°";
        document.getElementById("update-time").innerText = "CANLI VERÄ°: " + new Date().toLocaleTimeString();

        // AkÄ±llÄ± YaÅŸam Analizi (Algoritma)
        document.getElementById("p-hali").innerText = (p > 0 ? "2/10" : (t > 12 && t < 26 ? "10/10" : "6/10"));
        document.getElementById("p-mangal").innerText = (w > 22 || p > 0 ? "1/10" : "9/10");
        document.getElementById("p-vapur").innerText = (w > 45 ? "Ä°ptaller" : "Normal");
        document.getElementById("p-balik").innerText = (t < 17 ? "Ã‡ok Ä°yi" : "DÃ¼ÅŸÃ¼k");

        const statusMap = {0: "GÃœNEÅLÄ°", 1: "AÃ‡IK", 3: "BULUTLU", 61: "YAÄMURLU", 71: "KARLI"};
        document.getElementById("weather-status").innerText = statusMap[data.current.weather_code] || "AÃ‡IK";

        updateLiveChart(data.hourly.temperature_2m.slice(0, 24));
    } catch (e) { document.getElementById("weather-status").innerText = "BAÄLANTI YOK"; }
}

function updateLiveChart(temps) {
    const ctx = document.getElementById('liveChart').getContext('2d');
    if(mainChart) mainChart.destroy();
    mainChart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: Array.from({length: 24}, (_, i) => i + ":00"),
            datasets: [{ label: 'SÄ±caklÄ±k', data: temps, borderColor: '#00f2ff', tension: 0.4, fill: true, backgroundColor: 'rgba(0,242,255,0.05)' }]
        },
        options: { plugins: { legend: { display: false } }, scales: { y: { display: false }, x: { grid: { display: false }, ticks: { color: 'rgba(255,255,255,0.5)', font: { size: 8 } } } } }
    });
}
// 5 dakikada bir oto-refresh
setInterval(getWeatherData, 300000);
</script>
</body>
</html>
